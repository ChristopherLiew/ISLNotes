---
title: "R Notebook"
output: html_notebook
---

# 4.6.1 The Stock Market Data
```{r}
library(ISLR)
head(Smarket)
cor(Smarket[,-9])
plot(Smarket$Volume)
```

# 4.6.2 Logistic Regression

```{r}
f2 <- glm(Direction ~ Lag1 + Lag2 + Lag3 + Lag4 + Lag5 + Volume, data=Smarket, family=binomial)
summary(f2)
coef(f2)
summary(f2)$coef
summary(f2)$coef[,4]
```

Predict response based on predictors:
```{r}
gprob <- predict(f2, type = 'response')
gprob[1:10]
contrasts(Smarket$Direction)
```

Generate confusion matrix:
```{r}
gpred <- rep('Down', 1250)
gpred[gprob > 0.5] <- 'Up'
table(gpred, Smarket$Direction)
```

Calculate the training error rate on all training set:
```{r}
(145 + 507) / 1250
mean(gpred == Smarket$Direction)
```

Split existing training set to training and test subset:
```{r}
train <- (Smarket$Year < 2005)
sm2005 <- Smarket[!train,]
dim(sm2005)
direction2005 <- sm2005$Direction
```

Build a logistic regression model on training set:
```{r}
f2.2 <- glm(Direction ~ Lag1 + Lag2 + Lag3 + Lag4 + Lag5 + Volume, 
            data=Smarket, family=binomial, subset = train)
```

With above model, predict response on test set, and calculating test error rate:
```{r}
gprob2005 <- predict(f2.2, sm2005, type = 'response')
gpred2005 <- rep('Down', 252)
gpred2005[gprob2005 > 0.5] <- 'Up'
table(gpred2005, direction2005)
# mean(gpred2005 == direction2005)
mean(gpred2005 != direction2005)
```

Predict again with removing irrelevant predictors:
```{r}
f2.p2 <- glm(Direction ~ Lag1 + Lag2, data=Smarket, family = binomial, subset=train)
gprob2005.p2 <- predict(f2.p2, sm2005, type="response")
gpred2005.p2 <- rep("Down", 252)
gpred2005.p2[gprob2005.p2 > 0.5] <- "Up"
table(gpred2005.p2, direction2005)
mean(gpred2005.p2 == direction2005)
```

Predict the returns associated with particular values of *Lag1* and *Lag2*:
```{r}
predict(f2.p2, newdata = data.frame(Lag1 = c(1.2, 1.5), Lag2 = c(1.1, -0.8)), type = 'response')
```

# 4.6.3 Linear Discriminant Analysis
```{r}
library(MASS)
ldaf <- lda(Direction ~ Lag1 + Lag2, data = Smarket, subset = train)
ldaf
plot(ldaf)
```

How to read this plot?
The y-axis is the probability of *Down* and *Up*.
What does the x-axis stand for?

```{r}
lda.pred <- predict(ldaf, sm2005)
names(lda.pred)
lda.class <- lda.pred$class
table(lda.class, direction2005)
mean(lda.class == direction2005)
sum(lda.pred$posterior[,1] > 0.5)
sum(lda.pred$posterior[,1] < 0.5)
lda.pred$posterior[1:20,1]
lda.class[1:20]
sum(lda.pred$posterior[,1] > 0.9)
```

# 4.6.4 Quadratic Discriminant Analysis

```{r}
qdaf <- qda(Direction ~ Lag1 + Lag2, data = Smarket, subset = train)
qdaf
qda.class <- predict(qdaf, sm2005)$class
table(qda.class, direction2005)
mean(qda.class == direction2005)
```

Compared with linear discriminant analysis, the accurate rate increased from 0.56 to 0.59.

# 4.6.5 K-Nearest Neighbours

